<!DOCTYPE html>
<html>

<head>
    <title>Wayne Music</title>
    <script type='text/javascript'>
        window.jQuery = window.$ = require('jquery');
    </script>
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/dark-theme.css">
    <link rel="stylesheet" href="fontawesome-free-5.11.2-web/css/all.css">
</head>

<body>
    <div id="root-container">
        <div id="left-side-dock" class="card layer-transparent">
            <button id="page-changing-cover" class="plain sqr1"><i class="fas fa-image"></i></button>
            <button id="page-changing-list" class="plain sqr1"><i class="fas fa-list"></i></button>
            <button id="page-changing-lyric" class="plain sqr1"><i class="fas fa-align-left"></i></button>
        </div>
        <div id="bottom-side-dock" class="card layer-transparent">
            <div id="audio-controls-container">
                <div id="audio-controls-metadata" class="card">
                    <div id="metadata-title" class="metadata-h1">Title</div>
                    <div id="metadata-album" class="metadata-h2">Album</div>
                </div>
                <div id="audio-controls" class="card layer-transparent">
                    <div id="audio-controls-btns" class="card">
                        <button id="audio-controls-playpause-btn" class="plain sqr1">
                            <i class="fas fa-play"></i>
                        </button>
                        <button id="audio-controls-lastone-btn" class="plain sqr2">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button id="audio-controls-nextone-btn" class="plain sqr2">
                            <i class="fas fa-step-forward"></i></i>
                        </button>
                        <button id="audio-controls-random-btn" class="plain sqr3">
                            <i class="fas fa-random"></i>
                        </button>
                        <button id="audio-controls-repeat-btn" class="plain sqr3">
                            <div id="repeat-btn-icon-layout">
                                <i id="repeat-btn-icon" class="unicode-symbol">&#x2B8C;</i>
                                <span id="repeat-btn-addition">1</span>
                            </div>
                        </button>
                    </div>
                    <div id="audio-controls-slider-container" class="card">
                        <div id="audio-controls-slider-value">00:00</div>
                        <input type="range" id="audio-controls-slider" min="0" max="1000" value="25"></input>
                        <div id="audio-controls-slider-popuphint">00:00</div>
                        <div id="audio-controls-slider-max"><span class="min">00</span><span>:</span><span
                                class="sec">00</span></div>
                    </div>

                </div>

            </div>
        </div>
        <div id="body-container" class="card layer-transparent">
        </div>
    </div>
    <script type='text/javascript' src='dist/Index.js'></script>
    <script type='text/javascript'>
        function updateTitle(title){
            if (title) {
                $('head title').html(`${title} - Wayne Music`)
            } else {
                $('head title').html(`Wayne Music`)
            }
        }
        function updateAudioInfo(title, album) {
            $('#metadata-title').html(title)
            $('#metadata-album').html(album)
        };
        function updateDuration(duration){
            $('#audio-controls-slider-max').each((_, span) => {
                span.innerHTML = duration;
            })
        }
        function updateCover(picture) {
            $('img#metadata-cover').attr('src', picture)
        }
        function updateCoverBackground(picture) {
            $('div.cover-background').css({
                "background": `url(${picture})`,
                "background-size": "contain",
                "background-position": "center",
                "filter": "blur(25px)",
            })
        }
        function updatePlayPauseBtn(playbackState) {
            if (playbackState == 'playing') {
                $("#audio-controls-playpause-btn").html('<i class="fas fa-pause"></i>')
            } else {
                $("#audio-controls-playpause-btn").html('<i class="fas fa-play"></i>')
            };
        }
        function updateRepeatBtn(loopState) {
            if (loopState) {
                $('#audio-controls-repeat-btn').html(
                    '<div id="repeat-btn-icon-layout">' +
                    '    <i id="repeat-btn-icon" class="unicode-symbol">&#x2B8C;</i>' +
                    '    <span id="repeat-btn-addition">1</span>' +
                    '</div>'
                )
            } else {
                $('#audio-controls-repeat-btn').html(
                    '<i class="unicode-symbol">&#x2B8C;</i>'
                )
            }
        }

        if (!OnResponds.Current) {
            OnResponds.Current = (data) => {
                updateTitle(data.title)
                updateAudioInfo(data.title, data.album)
                updateCover(data.picture)
                updateCoverBackground(data.picture)
                updateDuration(duration2string(data.duration))
            }
        }
        if (!OnResponds.PlaybackState) {
            OnResponds.PlaybackState = (data) => {
                updatePlayPauseBtn(data)
            }
        }
        if (!OnResponds.Loop) {
            OnResponds.Loop = (data) => {
                updateRepeatBtn(data)
            }
        }
        if (!OnResponds.Seek) {
            OnResponds.Seek = (data) => {
                updateSliderPos(data)
            }
        }

        $('#audio-controls-playpause-btn').click(() => {
            if (Responds["PlaybackState"] == 'playing') {
                w.AppIpc.Send2Audio("Remote", "PlaybackState", 'paused')
            }
            else {
                w.AppIpc.Send2Audio("Remote", "PlaybackState", 'playing')
            }
        });
        $('#audio-controls-repeat-btn').click(() => {
            let loop = !Responds["Loop"]
            w.AppIpc.Send2Audio("Remote", "Loop", loop)
        });

        let slider_is_mouse_down = false;
        function updateSliderPos(seek) {
            $('input[type="range"]#audio-controls-slider').each((_, slider) => {
                slider.value = seek * slider.max / Responds["Current"].duration
            });

            $('#audio-controls-slider-value').each((_, span) => {
                span.innerHTML = duration2string(Responds.Seek)
            })

        }
        window.setInterval(() => {
            if (Responds["PlaybackState"] != 'playing') return
            if (slider_is_mouse_down) return;
            Responds["Seek"] += 0.033
            updateSliderPos(Responds["Seek"])
        }, 33);
        $('input[type="range"]#audio-controls-slider').on('mousemove', (e) => {
            let slider = e.currentTarget
            let preSeek = Responds["Current"].duration * e.offsetX / slider.clientWidth
            $('#audio-controls-slider-popuphint').css({
                left: slider.offsetLeft + e.offsetX - 30,
                top: slider.offsetTop - 30
            })
            $('#audio-controls-slider-popuphint').html(duration2string(preSeek))

        })
        $('input[type="range"]#audio-controls-slider').on('mousedown', (e) => {
            let slider = e.currentTarget
            slider_is_mouse_down = true
        })
        $('input[type="range"]#audio-controls-slider').on('input change', (e) => {
            let slider = e.currentTarget
            slider_temp_value = slider.value
        })
        $('input[type="range"]#audio-controls-slider').on('mouseup', (e) => {
            if (!slider_is_mouse_down) return;
            let slider = e.currentTarget
            slider_is_mouse_down = false;
            let seeked_value = Responds["Current"].duration * slider_temp_value / slider.max;
            w.AppIpc.Send2Audio("Remote", "Seek", seeked_value)
        })
        $('button#page-changing-cover').click(() => {
            $('#body-container').load('cover')
        })
        $('button#page-changing-list').click(() => {
            $('#body-container').load('list')
        })

        $('#body-container').load('cover')

    </script>
</body>

</html>